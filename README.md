# üöÄ SferaTC Bot + Sfera AI

**Telegram Bot —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ç—Ä–µ–π–¥–µ—Ä–æ–≤** —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–æ–ª–æ—Å–æ–≤—ã–º AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º.

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://www.python.org/)
[![Next.js](https://img.shields.io/badge/Next.js-15-black.svg)](https://nextjs.org/)
[![LiveKit](https://img.shields.io/badge/LiveKit-Cloud-green.svg)](https://livekit.io/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û –ø—Ä–æ–µ–∫—Ç–µ](#–æ-–ø—Ä–æ–µ–∫—Ç–µ)
- [–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-—Ñ—É–Ω–∫—Ü–∏–∏)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

---

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

**SferaTC Bot** - —ç—Ç–æ Telegram –±–æ—Ç —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ –∏ –≥–æ–ª–æ—Å–æ–≤—ã–º AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º **Sfera AI**, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ Telegram Mini App.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **Telegram Bot** (Python) - –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Å –º–µ–Ω—é, –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. **Sfera AI Agent** (Python + LiveKit) - –≥–æ–ª–æ—Å–æ–≤–æ–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –º—É–ª—å—Ç–∏–ø–µ—Ä—Å–æ system
3. **Mini App Frontend** (Next.js 15) - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Sfera AI –≤ Telegram

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### Telegram Bot

#### ü§ñ Sfera AI
- **–ì–æ–ª–æ—Å–æ–≤–æ–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç** —Å –ø–∞–º—è—Ç—å—é –∏ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π
- –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Telegram Mini App (–∫–Ω–æ–ø–∫–∞ –≤ –º–µ–Ω—é)
- Multi-persona: Partner, Mentor, Psychologist
- Hybrid Knowledge Base search (Dense + Sparse vectors)

#### üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **–°–∫–∏–¥–∫–∏ –Ω–∞ –∫–æ–º–∏—Å—Å–∏–∏** - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∏

:
  - Tiger.com
  - Vataga Crypto
  - Whitelist Capital

> **Note:** –†–∞–∑–¥–µ–ª—ã "–°–∫—Ä–∏–Ω–µ—Ä—ã", "–¢–µ—Ä–º–∏–Ω–∞–ª—ã", "–°–Ω–∏–∑–∏—Ç—å ping" - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

#### üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π support** —Å LLM (–±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö –±–æ—Ç–∞)
- –≠—Å–∫–∞–ª–∞—Ü–∏—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –æ–±—Ä–∞—â–µ–Ω–∏–π

#### üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** (–æ–±—â–∞—è –∏ –∑–∞ –¥–µ–Ω—å)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** (approve, ban, lookup)
- **–†–∞—Å—Å—ã–ª–∫–∏**:
  - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
  - –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ–¥–∏–∞ (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, GIF)

### Sfera AI Agent

#### üé≠ Multi-Persona System

**1. Partner (–ù–∞–ø–∞—Ä–Ω–∏–∫)** - —Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫
- –ë—ã—Å—Ç—Ä—ã–µ, —á–µ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥

**2. Mentor (–ù–∞—Å—Ç–∞–≤–Ω–∏–∫)**
- –°–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥ –æ–±—É—á–µ–Ω–∏—è
- –ù–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
- –†–∞–∑–≤–∏—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –º—ã—à–ª–µ–Ω–∏—è
- **–¢—Ä–∏–≥–≥–µ—Ä—ã:** "–æ–±—ä—è—Å–Ω–∏", "–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç", "–Ω–∞—É—á–∏"

**3. Psychologist (–ü—Å–∏—Ö–æ–ª–æ–≥)**
- –≠–º–ø–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –¢–µ—Ö–Ω–∏–∫–∏ –ö–ü–¢ (–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∞—è –¢–µ—Ä–∞–ø–∏—è)
- –†–∞–±–æ—Ç–∞ —Å —ç–º–æ—Ü–∏—è–º–∏ (—Ç–∏–ª—å—Ç, FOMO, —Å—Ç—Ä–∞—Ö)
- **–¢—Ä–∏–≥–≥–µ—Ä—ã:** "—Ç–∏–ª—å—Ç", "fomo", "–ø–∞–Ω–∏–∫–∞", "–Ω–µ—Ä–≤—ã"

#### üß† –°–∏—Å—Ç–µ–º–∞ –ø–∞–º—è—Ç–∏

- **Episodic Memory** - –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- **Core Memory** - –∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- **Summary Memory** - —Å–∂–∞—Ç–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–µ—Å—Å–∏–π
- **Qdrant Vector DB** –¥–ª—è semantic search

#### üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

- **50+ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** –ø–æ —Ç—Ä–µ–π–¥–∏–Ω–≥—É –∏ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏
- **Hybrid Search** (Dense + Sparse RRF)
- **Two-Stage Retrieval**:
  1. Discovery - –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π summary
  2. Retrieval - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —à–∞–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞

#### üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–≥–µ–Ω—Ç–∞

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–µ—à |
|-----------|----------|-----|
| `search_knowledge_base` | –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π | 30 –º–∏–Ω |
| `search_web` | Google Custom Search | 10 –º–∏–Ω |
| `get_crypto_price` | Binance API (real-time) | 30 —Å–µ–∫ |
| `get_weather` | wttr.in –ø–æ–≥–æ–¥–∞ | –ù–µ—Ç |
| `search_video` | DuckDuckGo video search | –ù–µ—Ç |
| `send_email` | Gmail SMTP | –ù–µ—Ç |
| `save_user_name` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ | –ù–µ—Ç |
| `update_profile` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è | –ù–µ—Ç |
| `start_plan` | –ó–∞–ø—É—Å–∫ –æ–±—É—á–∞—é—â–µ–≥–æ –ø–ª–∞–Ω–∞ | –ù–µ—Ç |

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend (Telegram Bot)

```python
python-telegram-bot  # Telegram API
fastapi             # Web server –¥–ª—è webhook + Mini App
sqlalchemy          # ORM –¥–ª—è –ë–î
httpx               # Async HTTP client
python-dotenv       # Environment variables
```

**Database:** PostgreSQL –∏–ª–∏ SQLite

### Backend (Sfera AI)

```python
livekit-agents      # Voice AI framework
livekit-plugins-google  # Gemini integration
qdrant-client       # Vector database
fastembed==0.5.1    # Fast embeddings
aiohttp             # Async HTTP
duckduckgo-search   # Video search
sentry-sdk          # Error monitoring (optional)
```

**LLM:** Google Gemini 2.5 Flash (Native Audio)

### Frontend (Mini App)

```json
{
  "next": "15.x",
  "react": "19.x",
  "@livekit/components-react": "^2.x",
  "livekit-client": "^2.x",
  "motion": "^11.x",
  "tailwindcss": "^3.x"
}
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Node.js 18+
- PostgreSQL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ SQLite)
- Accounts:
  - Telegram Bot Token
  - LiveKit Cloud
  - Google AI Studio (Gemini API)
  - Qdrant Cloud
  - Google Custom Search (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd "SferaTC Bot + Sfera AI"
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

#### Telegram Bot

```bash
# –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
pip install -r requirements.txt
```

#### Sfera AI

```bash
cd SferaAI_2
pip install -r requirements.txt
```

#### Frontend

```bash
cd SferaAI_2/frontend
npm install
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –û—Å–Ω–æ–≤–Ω–æ–π `.env` (–≤ –∫–æ—Ä–Ω–µ)

```env
# === TELEGRAM BOT ===
TELEGRAM_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
BOT_USERNAME=YourBot_bot
ADMIN_CHAT_ID=123456789

# === DATABASE ===
# SQLite (–¥–ª—è dev)
DATABASE_URL=sqlite:///./sferatc_dev.db
# PostgreSQL (–¥–ª—è production)
# DATABASE_URL=postgresql://user:password@localhost/sferatc

# === WEBHOOK (–¥–ª—è production) ===
WEBHOOK_URL=https://yourdomain.com
WEBHOOK_SECRET_TOKEN=your-secret-token
WEBHOOK_PORT=8443

# === OPENROUTER (–¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ ChatGPT –≤ support) ===
OPENROUTER_API_KEY=sk-or-...

# === TELEGRAM CHANNEL ===
TELEGRAM_CHANNEL_URL=https://t.me/your_channel
```

#### `SferaAI_2/.env`

```env
# === LIVEKIT ===
LIVEKIT_URL=wss://your-project.livekit.cloud
LIVEKIT_API_KEY=APIxxxxxxxxxxxxxxx
LIVEKIT_API_SECRET=xxxxxxxxxxxxxxxxxxxxxx

# === GOOGLE GEMINI ===
GOOGLE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXX

# === QDRANT ===
QDRANT_HOST=https://xxxxx-xxxxx.aws.cloud.qdrant.io:6333
QDRANT_API_KEY=xxxxxxxxxxxxxxxxxxxxxxx

# === GOOGLE SEARCH (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ===
GOOGLE_CSE_ID=your-custom-search-engine-id

# === TELEGRAM (–¥–ª—è auth –≤ Mini App) ===
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# === MONITORING (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ===
SENTRY_DSN=https://...@sentry.io/...
REDIS_URL=redis://...
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Qdrant

```bash
cd SferaAI_2

# –°–æ–∑–¥–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏
python scripts/setup_kb.py

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ KB
python scripts/ingest_kb_data.py
```

### 5. –°–±–æ—Ä–∫–∞ Frontend

```bash
cd SferaAI_2/frontend
npm run build

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ mini_app/public/
cd ../..
rm -rf mini_app/public/*
cp -r SferaAI_2/frontend/out/* mini_app/public/
```

### 6. –ó–∞–ø—É—Å–∫

#### Development (Polling)

```bash
# Terminal 1: Telegram Bot
python main.py

# Terminal 2: Sfera AI Agent
cd SferaAI_2
python agent.py
```

#### Production (Webhook)

```bash
# –° systemd (—Å–º. —Ä–∞–∑–¥–µ–ª –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
sudo systemctl start sferatc-bot
sudo systemctl start sfera-agent
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Telegram Bot Settings

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `config.py`:

```python
@dataclass
class Settings:
    # Core
    TELEGRAM_TOKEN: str
    ADMIN_CHAT_ID: str
    DATABASE_URL: str
    
    # Webhook
    WEBHOOK_URL: Optional[str]
    WEBHOOK_PORT: int = 8443
    WEBHOOK_SECRET_TOKEN: Optional[str]
    
    # ChatGPT (OpenRouter)
    OPENROUTER_API_KEY: Optional[str]
    CHATGPT_MODELS: List[str]  # Free models
    
    # Tools
    TOOLS_DATA: Dict[str, Any]  # Trading tools config
    
    # Support
    SUPPORT_LLM_ENABLED: bool = True
    
    # Media URLs
    WELCOME_IMAGE_URL: Optional[str]
    TOOLS_IMAGE_URL: Optional[str]
    ...
```

### Sfera AI Config

–§–∞–π–ª `SferaAI_2/config.py`:

```python
@dataclass
class Config:
    # Memory
    memory: MemoryConfig
    
    # Knowledge Base
    kb: KBConfig
    
    # Timeouts
    GOOGLE_SEARCH_TIMEOUT: int = 8
    WEATHER_TIMEOUT: int = 6
    
    # Validation
    def validate(self) -> Dict[str, Any]:
        ...
```

---

## üåê –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production Setup (Linux)

#### 1. Systemd Service - Telegram Bot

`/etc/systemd/system/sferatc-bot.service`:

```ini
[Unit]
Description=SferaTC Telegram Bot
After=network.target

[Service]
Type=simple
User=youruser
WorkingDirectory=/path/to/project
Environment="PATH=/path/to/project/venv/bin"
ExecStart=/path/to/project/venv/bin/python main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### 2. Systemd Service - Sfera AI Agent

`/etc/systemd/system/sfera-agent.service`:

```ini
[Unit]
Description=Sfera AI LiveKit Agent
After=network.target

[Service]
Type=simple
User=youruser
WorkingDirectory=/path/to/project/SferaAI_2
Environment="PATH=/path/to/project/venv/bin"
ExecStart=/path/to/project/venv/bin/python agent.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
sudo systemctl daemon-reload
sudo systemctl enable sferatc-bot sfera-agent
sudo systemctl start sferatc-bot sfera-agent

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
sudo systemctl status sferatc-bot
sudo systemctl status sfera-agent

# –õ–æ–≥–∏
sudo journalctl -u sferatc-bot -f
sudo journalctl -u sfera-agent -f
```

#### 4. Nginx (–¥–ª—è Mini App + Webhook)

```nginx
server {
    listen 443 ssl http2;
    server_name yourdomain.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # Mini App
    location / {
        proxy_pass http://localhost:8443;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # Webhook
    location /webhook {
        proxy_pass http://localhost:8443/webhook;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
SferaTC Bot + Sfera AI/
‚îú‚îÄ‚îÄ main.py                    # Entry point (FastAPI + PTB)
‚îú‚îÄ‚îÄ config.py                  # Settings & validation
‚îú‚îÄ‚îÄ keyboards.py               # Telegram keyboards
‚îú‚îÄ‚îÄ requirements.txt           # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ handlers/                  # Command & message handlers
‚îÇ   ‚îú‚îÄ‚îÄ common_handlers.py     # /start, /help, routing
‚îÇ   ‚îú‚îÄ‚îÄ admin_handlers.py      # Admin panel
‚îÇ   ‚îú‚îÄ‚îÄ sfera_handlers.py      # Sfera AI launcher
‚îÇ   ‚îú‚îÄ‚îÄ tools_handlers.py      # Trading tools
‚îÇ   ‚îú‚îÄ‚îÄ admin/                 # Admin submodules
‚îÇ   ‚îî‚îÄ‚îÄ user/
‚îÇ       ‚îî‚îÄ‚îÄ support_handler.py # LLM support
‚îÇ
‚îú‚îÄ‚îÄ services/                  # Business logic
‚îÇ   ‚îú‚îÄ‚îÄ chatgpt_service.py     # OpenRouter streaming
‚îÇ   ‚îú‚îÄ‚îÄ broadcast_scheduler.py # Scheduled broadcasts
‚îÇ   ‚îú‚îÄ‚îÄ cache_service.py       # ChatGPT caching
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ models/                    # SQLAlchemy models
‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ broadcast.py
‚îÇ   ‚îî‚îÄ‚îÄ crud.py
‚îÇ
‚îú‚îÄ‚îÄ mini_app/                  # Mini App static files
‚îÇ   ‚îî‚îÄ‚îÄ public/                # Built frontend (from SferaAI_2/frontend/out)
‚îÇ
‚îú‚îÄ‚îÄ SferaAI_2/                 # Sfera AI Agent
‚îÇ   ‚îú‚îÄ‚îÄ agent.py               # LiveKit agent entrypoint
‚îÇ   ‚îú‚îÄ‚îÄ prompts.py             # Multi-persona prompts
‚îÇ   ‚îú‚îÄ‚îÄ tools.py               # Agent tools
‚îÇ   ‚îú‚îÄ‚îÄ knowledge_base.py      # KB hybrid search
‚îÇ   ‚îú‚îÄ‚îÄ qdrant_memory_client.py # Memory system
‚îÇ   ‚îú‚îÄ‚îÄ unified_user_state.py  # User state + profiles
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # Agent config
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt       # Agent dependencies
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ agent/                 # Modular components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assistant.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ memory_loader.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ session_manager.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ data/                  # Knowledge base & courses
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ knowledge_base_unified/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ MASTER_*.md    # 50+ documents
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ frontend/              # Next.js 15 Mini App
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ next.config.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ out/               # Build output
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ scripts/
‚îÇ       ‚îú‚îÄ‚îÄ setup_kb.py        # Create Qdrant collections
‚îÇ       ‚îî‚îÄ‚îÄ ingest_kb_data.py  # Load KB data
‚îÇ
‚îî‚îÄ‚îÄ .env                       # Environment variables
```

---

## üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Mini App

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Mini App –ª–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –≤ webhook mode:
   ```bash
   # –í .env —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
   WEBHOOK_URL=https://your-ngrok-url.ngrok-free.app
   
   # –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
   python main.py
   ```

2. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
   ```bash
   ngrok http 8443
   # –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL –≤ WEBHOOK_URL
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

4. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –Ω–∞–∂–º–∏—Ç–µ "ü§ñ Sfera AI"

### Debugging

#### Telegram Bot

```python
# main.py - –≤–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
import logging
logging.basicConfig(level=logging.DEBUG)
```

#### Sfera AI Agent

```python
# agent.py
logging.basicConfig(level=logging.INFO)

# –î–ª—è debug –∞–≥–µ–Ω—Ç–∞
logging.getLogger("livekit").setLevel(logging.DEBUG)
```

#### Frontend

```bash
cd SferaAI_2/frontend
npm run dev
# ‚Üí http://localhost:3000
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ Sfera AI

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≤ `tools.py`:

```python
@function_tool()
async def my_new_tool(context: RunContext, param: str) -> str:
    """Tool description for LLM."""
    # Your logic
    return result
```

2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `agent.py`:

```python
from tools import ..., my_new_tool

extra_tools = [..., my_new_tool]
```

3. –û–±–Ω–æ–≤–∏—Ç–µ system prompt –≤ `prompts.py` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ Knowledge Base

1. –°–æ–∑–¥–∞–π—Ç–µ `.md` —Ñ–∞–π–ª –≤ `SferaAI_2/data/knowledge_base_unified/`:

```markdown
---
id: my_new_doc
title: "–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞"
category_1: trading  # –∏–ª–∏ psychology
category_2: breakouts  # –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
difficulty_level: beginner  # –∏–ª–∏ intermediate, advanced
---

# Summary
–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ...

# Step 1: –ó–∞–≥–æ–ª–æ–≤–æ–∫
–ö–æ–Ω—Ç–µ–Ω—Ç —à–∞–≥–∞ 1...

# Step 2: –ó–∞–≥–æ–ª–æ–≤–æ–∫
–ö–æ–Ω—Ç–µ–Ω—Ç —à–∞–≥–∞ 2...
```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω–∂–µ—Å—Ç:

```bash
cd SferaAI_2
python scripts/ingest_kb_data.py
```

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: `unified_state is not defined`

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é `agent.py` –ø–æ—Å–ª–µ bug fix (—Å–º. commit history)

### –û—à–∏–±–∫–∞: `VideoTrack` –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–ø–æ—Ä—Ç –≤ `session-view.tsx`:
```typescript
import { ..., VideoTrack } from '@livekit/components-react';
```

### –û—à–∏–±–∫–∞: Duplicate function `get_chatgpt_response`

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ `services/chatgpt_service.py`

### Mini App –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `WEBHOOK_URL` –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ frontend —Å–æ–±—Ä–∞–Ω:
   ```bash
   ls mini_app/public/index.html
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS headers –≤ `main.py`

### Qdrant –æ—à–∏–±–∫–∏

#### `400 Bad Request: No index for timestamp`

```bash
cd SferaAI_2
python scripts/setup_kb.py  # –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
```

#### Connection timeout

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `QDRANT_HOST` –∏ `QDRANT_API_KEY` –≤ `.env`

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](LICENSE)

---

## ü§ù Contributing

Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ issue.

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- Telegram Channel: [–£–∫–∞–∑–∞—Ç—å —Å—Å—ã–ª–∫—É]
- Support: [–£–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç]

---

**Made with ‚ù§Ô∏è by SferaTC Team**
