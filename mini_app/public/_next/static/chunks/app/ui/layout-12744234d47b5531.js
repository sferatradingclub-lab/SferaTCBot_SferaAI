(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[442],{114:(e,t,n)=>{Promise.resolve().then(n.bind(n,3423))},3423:(e,t,n)=>{"use strict";n.d(t,{SessionProvider:()=>u,w:()=>g});var r=n(9835),a=n(5931),o=n(8809),i=n(4707),c=n(8649),s=n(9064),l=n(9088);let d=(0,a.createContext)({appConfig:i.C,isSessionActive:!1,startSession:()=>{},endSession:()=>{}}),u=e=>{let{appConfig:t,children:n}=e,{room:i,isSessionActive:u,startSession:g,endSession:f}=function(e){let t=(0,a.useRef)(!1),n=(0,a.useMemo)(()=>{let e={videoCaptureDefaults:{resolution:c.gF.h1080,frameRate:30},dynacast:!0,adaptiveStream:!0,publishDefaults:{videoEncoding:{maxBitrate:3e6,maxFramerate:30},screenShareEncoding:{maxBitrate:5e6,maxFramerate:30},dtx:!1,videoCodec:"vp9",degradationPreference:"maintain-resolution"}};return new c.Wv(e)},[]),[r,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{function e(){o(!1)}function t(e){(0,s.c)({title:"Encountered an error with your media devices",description:"".concat(e.name,": ").concat(e.message)})}return n.on(c.u9.Disconnected,e),n.on(c.u9.MediaDevicesError,t),()=>{n.off(c.u9.Disconnected,e),n.off(c.u9.MediaDevicesError,t)}},[n]),(0,a.useEffect)(()=>()=>{t.current=!0,n.disconnect()},[n]);let i=(0,a.useMemo)(()=>c.xX.custom(async()=>{var t,n,r,a;let o=new URL(null!=(r=l.env.NEXT_PUBLIC_CONN_DETAILS_ENDPOINT)?r:"/api/connection-details",window.location.origin),i=(null==(n=window.Telegram)||null==(t=n.WebApp)?void 0:t.initData)||void 0,c=new URLSearchParams(window.location.search).get("userId")||void 0;try{let t=await fetch(o.toString(),{method:"POST",headers:{"Content-Type":"application/json","X-Sandbox-Id":null!=(a=e.sandboxId)?a:""},body:JSON.stringify({room_config:e.agentName?{agents:[{agent_name:e.agentName}]}:void 0,userId:c,initData:i})});return await t.json()}catch(e){throw console.error("Error fetching connection details:",e),Error("Error fetching connection details!")}}),[e]),d=(0,a.useCallback)(()=>{if(o(!0),"disconnected"===n.state){let{isPreConnectBufferEnabled:r}=e;(async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;for(let c=0;c<a;c++)try{await Promise.all([n.localParticipant.setMicrophoneEnabled(!0,void 0,{preConnectBuffer:r}),i.fetch({agentName:e.agentName}).then(e=>n.connect(e.serverUrl,e.participantToken))]);return}catch(n){if(console.error("Connection attempt ".concat(c+1," failed:"),n),c===a-1){if(t.current)return;throw(0,s.c)({title:"Unable to connect to agent",description:"Please check your internet connection. Click the Start button to try again."}),o(!1),n}let e=Math.min(1e3*Math.pow(2,c),5e3);console.log("Retrying in ".concat(e,"ms...")),await new Promise(t=>setTimeout(t,e))}})().catch(e=>{console.error("All connection attempts failed:",e)})}},[n,e,i,t]),u=(0,a.useCallback)(()=>{"disconnected"!==n.state&&n.disconnect(),o(!1)},[n]);return{room:n,isSessionActive:r,startSession:d,endSession:u}}(t),v=(0,a.useMemo)(()=>({appConfig:t,isSessionActive:u,startSession:g,endSession:f}),[t,u,g,f]);return(0,r.jsx)(o.R.Provider,{value:i,children:(0,r.jsx)(d.Provider,{value:v,children:n})})};function g(){return(0,a.useContext)(d)}},4707:(e,t,n)=>{"use strict";n.d(t,{C:()=>r});let r={companyName:"LiveKit",pageTitle:"Sfera AI",pageDescription:"A voice agent built with LiveKit",supportsChatInput:!0,supportsVideoInput:!0,supportsScreenShare:!0,isPreConnectBufferEnabled:!0,logo:"/lk-logo.svg",accent:"#002cf2",logoDark:"/lk-logo-dark.svg",accentDark:"#1fd5f9",startButtonText:"Start call",sandboxId:void 0,agentName:void 0}},5496:(e,t,n)=>{"use strict";n.d(t,{cn:()=>l,uj:()=>s,wN:()=>c});var r=n(5931),a=n(8951),o=n(2411),i=n(4707);n(9088).env.SANDBOX_ID;let c="theme-mode",s="(prefers-color-scheme: dark)";function l(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.QP)((0,a.$)(t))}(0,r.cache)(async e=>i.C)},9064:(e,t,n)=>{"use strict";n.d(t,{AlertToast:()=>f,c:()=>g});var r=n(9835),a=n(5602),o=n(4019);n(5931);var i=n(7951),c=n(5496);let s=(0,i.F)(["relative w-full rounded-lg border px-4 py-3 text-sm grid grid-cols-[0_1fr] gap-y-0.5 items-start","has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] has-[>svg]:gap-x-3 [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current"],{variants:{variant:{default:"bg-card text-card-foreground",destructive:["text-destructive bg-destructive/10 border-destructive/20","[&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"]}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:n,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,c.cn)(s({variant:n}),t),...a})}function d(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"alert-title",className:(0,c.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...n})}function u(e){let{className:t,...n}=e;return(0,r.jsx)("div",{"data-slot":"alert-description",className:(0,c.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...n})}function g(e){return a.oR.custom(t=>(0,r.jsx)(f,{id:t,title:e.title,description:e.description}),{duration:1e4})}function f(e){let{title:t,description:n,id:i}=e;return(0,r.jsxs)(l,{onClick:()=>a.oR.dismiss(i),className:"bg-accent",children:[(0,r.jsx)(o.i,{weight:"bold"}),(0,r.jsx)(d,{children:t}),n&&(0,r.jsx)(u,{children:n})]})}}},e=>{e.O(0,[571,85,874,900,341,358],()=>e(e.s=114)),_N_E=e.O()}]);