"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[495],{495:(e,t,r)=>{r.r(t),r.d(t,{SphereVisualizer:()=>h});var n=r(9835),a=r(5931),i=r(257),l=r(9225),s=r(4861),c=r(7335);let o=e=>{let{index:t,dataArray:r}=e,l=(0,a.useRef)(null),{rotation:c,color:o,angle:u}=(0,a.useMemo)(()=>{let e=t/128*Math.PI*2+Math.PI/2,r=(Math.sin(e+Math.PI/2)+1)/2;return{rotation:new i.O9p(0,0,e-Math.PI/2),color:"hsl(".concat(360*(.75-.25*r),", 100%, 50%)"),angle:e}},[t]);return(0,s.D)(()=>{if(!l.current||!r)return;let e=t;t>64&&(e=128-t);let n=Math.min(Math.max(Math.floor(64*Math.pow(e/64,2.5)),0),r.length-1),a=r[n]||0,i=a>5?.1+a/255*1.5:0;l.current.scale.set(1,i,1),l.current.visible=i>.001;let s=2.5+.25*i,c=Math.cos(u)*s,o=Math.sin(u)*s;l.current.position.set(c,o,0)}),(0,n.jsxs)("mesh",{ref:l,rotation:c,children:[(0,n.jsx)("planeGeometry",{args:[.06,.5]}),(0,n.jsx)("meshBasicMaterial",{color:o,toneMapped:!1})]})},u=e=>{let{analyser:t,dataArray:r,isActive:a}=e;return(0,s.D)(()=>{t&&r&&(a?t.getByteFrequencyData(r):r.fill(0))}),(0,n.jsx)("group",{children:Array.from({length:128}).map((e,t)=>(0,n.jsx)(o,{index:t,dataArray:r},t))})},h=e=>{let{isActive:t}=e,{audioTrack:r}=(0,l.V)(),i=(0,a.useRef)(null),s=(0,a.useRef)(null),o=(0,a.useRef)(null),h=(0,a.useRef)(null);return(0,a.useEffect)(()=>{var e;if(!r||!(null==(e=r.publication)?void 0:e.track))return;let t=r.publication.track.mediaStreamTrack;if(!t)return;let n=new(window.AudioContext||window.webkitAudioContext);o.current=n;let a=n.createAnalyser();a.fftSize=256,a.smoothingTimeConstant=.8,i.current=a;let l=n.createMediaStreamSource(new MediaStream([t]));return h.current=l,l.connect(a),s.current=new Uint8Array(a.frequencyBinCount),()=>{l.disconnect(),a.disconnect(),n.close()}},[r]),(0,n.jsx)("div",{className:"relative h-[200px] w-[200px] transition-opacity duration-500 sm:h-[250px] sm:w-[250px] md:h-[300px] md:w-[300px] ".concat(t?"opacity-100":"opacity-50"),style:{background:"transparent"},children:(0,n.jsx)(c.Hl,{camera:{position:[0,0,8],fov:50},gl:{alpha:!0,antialias:!0},style:{background:"transparent"},children:(0,n.jsx)(u,{analyser:i.current,dataArray:s.current,isActive:t})})})}}}]);