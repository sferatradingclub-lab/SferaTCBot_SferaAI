# Документация проекта Sfera AI

## Обзор
Sfera AI — это продвинутый голосовой ИИ-ассистент, построенный на базе Google Gemini Realtime API и LiveKit. Ассистент обладает долгосрочной памятью, способностью выполнять действия (инструменты) и проактивно взаимодействовать с пользователем.

## Основные компоненты

### 1. Голосовой Агент (`agent.py`)
-   **Ядро**: Использует `Google Gemini Realtime` для мгновенного голосового ответа с низкой задержкой.
-   **Интеграция**: Работает через `LiveKit` для передачи аудио/видео потоков в реальном времени.
-   **Системный промпт**: Настроен в `prompts.py` (MASTER_SYSTEM_PROMPT) для задания личности и правил поведения.

### 2. Память (Long-Term Memory)
-   **LTM Client (`ltm_client.py`)**: Управляет состоянием пользователя и планами (хранение в JSON/TinyDB для простоты или Qdrant для векторов).
-   **Векторная память (`qdrant_memory_client.py`)**: Используется для семантического поиска по истории диалогов (Mem0).
-   **Функции**:
    -   Запоминание контекста между сессиями.
    -   Хранение активных планов (фитнес, обучение и т.д.).

### 3. Инструменты (`tools.py`)
Агент может вызывать следующие функции:
-   **`search_web`**: Поиск информации в интернете (через Google Search).
-   **`get_crypto_price`**: Получение текущих цен на криптовалюты.
-   **`get_weather`**: Прогноз погоды.
-   **`start_plan`**: Запуск долгосрочного плана (например, фитнес-план).
-   **`search_knowledge_base`**: Поиск по локальной базе знаний.

### 4. Система Личностей (Personas)
Агент динамически переключает стиль общения в зависимости от контекста и эмоций пользователя. Логика определена в `prompts.py`.

#### 1. Напарник (Partner) - *Default*
-   **Цель**: Эффективное выполнение задач.
-   **Стиль**: Профессиональный, лаконичный, ориентированный на действия.
-   **Триггеры**: Прямые вопросы ("Какая цена?", "Найди новости"), команды.

#### 2. Ментор (Mentor)
-   **Цель**: Развитие критического мышления (Сократический метод).
-   **Стиль**: Задает наводящие вопросы, не дает готовых ответов сразу, провоцирует на размышления.
-   **Триггеры**: Вопросы о стратегии, анализе, просьбы совета ("Что думаешь об этом графике?", "Стоит ли входить?").

#### 3. Психолог (Psychologist)
-   **Цель**: Эмоциональная поддержка и борьба с когнитивными искажениями (FOMO, тильт).
-   **Стиль**: Эмпатичный, поддерживающий, использует техники КПТ (Когнитивно-Поведенческой Терапии).
-   **Триггеры**: Маркеры стресса, жалобы на потери, страх, жадность ("Я боюсь упустить сделку", "Я ненавижу этот рынок").

### 5. Проактивная Система
Позволяет агенту самому инициировать общение.
-   **`proactive_scheduler.py`**: Фоновый процесс, проверяет состояние пользователей каждые 5 минут.
-   **`session_registry.py`**: Отслеживает, кто из пользователей сейчас онлайн.
-   **Логика**: Если у пользователя активен план и прошло >24 часов с последнего обновления, агент:
    -   Если пользователь **Онлайн**: Говорит голосом ("Привет, пора заниматься!").
    -   Если пользователь **Офлайн**: Логирует событие (заготовка под Push/SMS).

### 5. Frontend
-   **Технологии**: Next.js, TypeScript, TailwindCSS.
-   **Компоненты**:
    -   `ControlPanel`: Управление соединением.
    -   `SessionView`: Визуализация голоса (SoundWave).
    -   `ChatPanel`: Отображение текстовых сообщений и ссылок от агента.

## Структура проекта
-   `/`: Корневая директория с Python-бэкендом.
-   `/frontend`: Исходный код веб-интерфейса.
-   `/db`: Локальные файлы базы данных.
